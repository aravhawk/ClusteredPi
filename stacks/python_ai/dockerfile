FROM alpine:latest AS getfiles
# install git
RUN apk --no-cache add git
RUN mkdir /src
WORKDIR /src
RUN git clone https://www.github.com/kevinmcaleer/pythonai 
WORKDIR /src/pythonai

# Download Vosk model
RUN curl https://alphacephei.com/vosk/models/vosk-model-en-us-0.22.zip -o model.zip && unzip model.zip && rm model.zip

# Install Python
RUN apk --no-cache add python3
RUN apk --no-cache add python3-dev
RUN apk --no-cache add libffi-dev gcc libc-dev
RUN python3 -m ensurepip --upgrade
RUN pip3 install --upgrade pip

# Install Vosk
RUN pip3 install vosk

# Create virtual environment
RUN python3 -m venv venv
RUN source venv/bin/activate
RUN apk --no-cache add portaudio portaudio-dev

# Install Python dependencies
RUN pip3 install -r requirements.txt

# Run the application
RUN python3 alf.py